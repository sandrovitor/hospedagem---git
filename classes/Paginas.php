<?php class Paginas{    // BANCO DE DADOS    private $pdo;    private $db_user;    private $db_senha;    private $db_name;    private $db_host;                    public function __construct()    {        include('conecta.php');        $this->db_user = $db_username;        $this->db_senha = $db_pass;        $this->db_name = $db_name;        $this->db_host = $db_host;        $this->PDO();                if(!isset($_SESSION)) {            session_start();        }    }        private function PDO()    {        // Conexão via PDO        $this->pdo = new PDO ( "mysql:host=".$this->db_host.";dbname=".$this->db_name, $this->db_user, $this->db_senha );        if (!$this->pdo) {            die ( 'Erro ao criar a conexão' );        }                $this->pdo->setAttribute( PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION );    }        protected function FormatTel($numero_telefone) {        $total = strlen($numero_telefone);        $novo_numero = '';                for($i=0; $i < $total; $i++) {            switch(substr($numero_telefone, $i, 1)) {                case '1':                case '2':                case '3':                case '4':                case '5':                case '6':                case '7':                case '8':                case '9':                case '0':                    $novo_numero .= substr($numero_telefone, $i, 1);                    break;                                                }        }                $total = strlen($novo_numero);                    if($total > 8) {            $x = '('.substr($novo_numero, 0, $total-8).') '.substr($novo_numero, $total-8, 4) .'-'. substr($novo_numero, $total-4, 4);        } else if($total == 8) {            $x = substr($novo_numero, $total-8, 4) .'-'. substr($novo_numero, $total-4, 4);        } else {            $x = $numero_telefone;        }                        return $x;    }        protected function FormatCel($numero_celular) {        $total = strlen($numero_celular);        $novo_numero = '';                for($i=0; $i < $total; $i++) {            switch(substr($numero_celular, $i, 1)) {                case '1':                case '2':                case '3':                case '4':                case '5':                case '6':                case '7':                case '8':                case '9':                case '0':                    $novo_numero .= substr($numero_celular, $i, 1);                    break;                                                    }        }                $total = strlen($novo_numero);        if($total > 9) {            $x = '('.substr($novo_numero, 0, $total-9).') '.substr($novo_numero, $total-9, 5) .'-'. substr($novo_numero, $total-4, 4);        } else if($total == 9) {            $x = substr($novo_numero, $total-9, 5) .'-'. substr($novo_numero, $total-4, 4);        } else if($total == 8) {            $x = substr($novo_numero, $total-8, 4) .'-'. substr($novo_numero, $total-4, 4);        } else {            $x = $numero_celular;        }                                        return $x;    }        public function NovoUsuario()    {                $abc = $this->pdo->query('SELECT cidade.id, cidade.cidade, cidade.estado, cidade.solicitante_id FROM cidade WHERE cidade.hospedeiro = 0 ORDER BY cidade.cidade ASC');        $sel_soli = '';                while($reg = $abc->fetch(PDO::FETCH_OBJ)) {            // Verifica se já tem solicitante designado            if($reg->solicitante_id != 0) { // JÁ TEM                $sel_soli .= '<option value="'.$reg->id.'" disabled>'.$reg->cidade.'/'.$reg->estado.' &nbsp;  &nbsp; [NÃO DISPONÍVEL]</option>';            } else { // NÃO TEM                $sel_soli .= '<option value="'.$reg->id.'">'.$reg->cidade.'/'.$reg->estado.'</option>';            }        }                $abc = $this->pdo->query('SELECT * FROM login WHERE 1 ORDER BY nivel ASC, nome ASC, sobrenome ASC');        $lista_usu = '';                if($abc->rowCount() > 0) {            $lista_usu =<<<DADOS<table class="table table-sm table-bordered table-striped">    <thead class="thead-dark">        <tr>            <th>Nome</th>            <th>Usuário</th>            <th>Nível de Acesso</th>            <th>Tel Residencial</th>            <th>Tel Celular</th>            <th>E-mail</th>        </tr>    </thead>    <tbody>        DADOS;                        while($reg = $abc->fetch(PDO::FETCH_OBJ)) {                if($reg->nivel == 1) {                    $reg->nivel = 'Solicitante';                } else if($reg->nivel == 10) {                    $reg->nivel = 'Responsável da Hospedagem';                } else if($reg->nivel == 20) {                    $reg->nivel = 'Administrador';                }                                $lista_usu.=<<<DADOS        <tr>            <td>$reg->nome $reg->sobrenome</td>            <td>$reg->usuario</td>            <td>$reg->nivel</td>            <td>$reg->tel_res</td>            <td>$reg->tel_cel</td>            <td>$reg->email</td>        </tr>DADOS;            }                        $lista_usu.=<<<DADOS    </tbody></table><br>						<a href="admin.php?page=4">Clique aqui</a> para mais informações, ou navegue até <code>Administração > Usuários > Listar Usuários</code>.DADOS;        } else {            $lista_usu = 'Nenhum usuario encontrado ainda';        }                $html = <<<DADOS        <script>function senhaCheck(campo){	if($(campo).prop('checked') == false) {		$('#senha_box').slideDown('fast');        $('#senha_box input').attr('required',true);        marcaRequired();	} else {		$('#senha_box').slideUp('fast');        $('#senha_box input').attr('required',false);        marcaRequired();	}}</script><!-- CONTEUDO --><div class="container">	<!-- BREADCRUMB -->	<ul class="breadcrumb">		<li class="breadcrumb-item"><a href="admin.php">Administração</a></li>		<li class="breadcrumb-item active">Novo Usuário</li>	</ul>	<!-- FIM DO BREADCRUMB -->		<div class="row">		<div class="col-12" id="frame_msg"></div>	</div>    <div class="row">        <div class="col-12">            <h4><strong><i class="fa fa-user-plus"></i> &nbsp;NOVO USUÁRIO</strong></h4><hr>        </div>    </div>	    <form action="#" method="post" onsubmit="adm_usuNovo(); return false;">        <div class="row">    		<div class="col-12 col-md-4">            	<div class="form-group">                	<label for="nome">Nome:</label>                	<input type="text" id="nome" name="nome" class="form-control" required maxlength="25">                	<small for="nome" class="text-secondary">Somente o primeiro nome. <strong>Ex.:</strong> André, João, LS...</small>                </div>            	<div class="form-group">                	<label for="sobrenome">Sobrenome:</label>                	<input type="text" id="sobrenome" name="sobrenome" class="form-control" required maxlength="25">                	<small for="sobrenome" class="text-secondary">Somente o último nome. <strong>Ex.:</strong> Oliveira, Silva, Itaberaba...</small>                </div>            	<div class="form-group">                	<label>Usuário:</label>                	<input type="text" id="usuario" name="usuario" class="form-control" required maxlength="25">                	<small class="text-secondary">Nome para fazer login no sistema. <strong>Ex.:</strong> AndreO, JoaoS...</small>                </div>    			<div class="form-group">    				<div class="checkbox">    					<label><input type="checkbox" name="senha_pad" id="senha_pad" value="Y" onclick="javascript: senhaCheck(this)" checked="checked"><strong>Usar senha padrão (123)</strong></label><br>    					<small class="text-secondary">Desmarque para criar uma senha. Se marcada, senha padrão do sistema será criada.</small>    				</div>    			</div>    			<div id="senha_box" style="display:none" class="card bg-secondary text-white">    				<div class="card-body">        				<div class="form-group">        					<label for="form1_senha1">Senha:</label>        					<input type="password" id="form1_senha1" name="senha1" class="form-control" maxlength="15">        					<span class="help-block">Letras e números. Mínimo 6 caracteres, máximo 15 caracteres.</span>        				</div>        				<div class="form-group">        					<label for="form1_senha2">Repita a senha:</label>        					<input type="password" id="form1_senha2" name="senha2" class="form-control" maxlength="15">        					<span class="help-block">Repita a senha criada no campo anterior.</span>        				</div>        			</div>    			</div>    			<div class="form-group">    				<label for="tel_res">Telefone Residencial:</label>    				<input type="text" id="tel_res" name="tel_res" pattern="[0-9]" placeholder="Somente números" class="form-control" maxlength="10">    				<small for="tel_res" class="text-secondary">Número de telefone residencial com o DDD. Somente números. <strong>Ex.:</strong> 7133123456...</small>    			</div>    		</div>    		<div class="col-12 col-md-4">    			<div class="form-group">    				<label for="tel_cel">Telefone Celular:</label>    				<input type="text" id="tel_cel" name="tel_cel" pattern="[0-9]" placeholder="Somente números" class="form-control" maxlength="11">    				<small for="tel_cel" class="text-secondary">Número de telefone celular com o DDD e nono dígito. Somente números. <strong>Ex.:</strong> 71988881234...</small>    			</div>    			<div class="form-group">    				<label for="email">E-mail:</label>    				<input type="email" id="email" name="email" class="form-control" maxlength="35">    			</div>    			<div class="form-group">    				<label for="nivel">Nível de acesso:</label>    				<select id="nivel" name="nivel" class="form-control" onchange="if($(this).val() == '1') {\$('#pre_designacao').slideDown();} else {\$('#pre_designacao').slideUp();}">    					<option value="1">Solicitante de Hospedagem</option>    					<option value="10">Responsável da Hospedagem na Cidade</option>    					<option value="20">Administrador do Sistema</option>    				</select>    			</div>    			<div class="card bg-light" id="pre_designacao">    				<div class="card-body">    					<div class="form-group">            				<label for="designacao_1">Pré-designação (Solicitante de Hospedagem):</label><br>            				<small class="text-secondary">Ao criar o usuário, automaticamente será designado para a cidade que você escolher aqui.            				Essa opção vai 'falhar' caso alguém designe outra pessoa para a cidade durante o período que você estiver preenchendo esse formulário.</small>            				<select id="designacao_1" name="designacao_1" class="form-control">            					<option value="0">Escolha</option>                                $sel_soli            				</select>                            <small>Essa opção pode ficar em branco se desejar fazer a designação depois.</small>            			</div>    				</div>    			</div>                <div class="form-group float-right">                    <br>                    <button type="submit" class="btn btn-success">Criar</button>                    <button type="reset" class="btn btn-outline-warning">Resetar</button>                </div>    		</div>    	</div>    </form>    <div class="row">	   <div class="col-md-12">			<div class="card">				<div class="card-header">					<a data-toggle="collapse" data-target="#panel1"><strong>LISTA COMPLETA DE USUÁRIOS</strong></a>				</div>				<div id="panel1" class="collapse">					<div class="card-body">						$lista_usu					</div>				</div>			</div>		</div>    </div></div>DADOS;                return $html;    }        public function EditarUsuario()    {        $html = '';                $sel_usu = '';        $abc = $this->pdo->query('SELECT id, CONCAT(nome, " ", sobrenome) AS nome_completo FROM login WHERE 1 ORDER BY nome ASC, sobrenome ASC');        while($reg = $abc->fetch(PDO::FETCH_OBJ)) {            $sel_usu .= '<option value="'.$reg->id.'">'.$reg->nome_completo.'</option>';        }                                $html =<<<DADOS<!-- CONTEUDO --><div class="container">	<!-- BREADCRUMB -->	<ul class="breadcrumb">		<li class="breadcrumb-item"><a href="admin.php">Administração</a></li>		<li class="breadcrumb-item active">Editar Usuário</li>	</ul>	<!-- FIM DO BREADCRUMB -->		<div class="row">		<div class="col-12" id="frame_msg"></div>	</div>    <div class="row">        <div class="col-12">            <h4><strong><i class="fa fa-edit"></i> &nbsp;EDITAR USUÁRIO</strong></h4><hr>        </div>    </div>    <div class="row">        <div class="col-12">            <div class="card bg-dark text-white">                <div class="card-body">                    <strong>Usuário: </strong>                    <select class="form-control" id="sel_usu" name="sel_usu" onchange="adm_usuCarrega()">                        <option value="0">- Escolha</option>                        $sel_usu                    </select>                </div>            </div>        </div>    </div>    <div class="row">        <div class="col-12" id="frame_info">                    </div>    </div></div>DADOS;        return $html;    }        public function EditarUsuario_form(array $info)    {        if(!is_array($info) || $info['status_servidor'] == false) {            echo 'Não foi possível resgatar dados do sistema. Erro interno.';        }                $n0 = $n1 = $n2 = '';        switch($info['nivel']) {            case '1':                $n0 = 'selected';                break;                            case '10':                $n1 = 'selected';                break;                            case '20':                $n2 = 'selected';                break;                        }                if($info['ult_login'] == '0000-00-00 00:00:00') {            $ult_login = 'Nunca acessou';        } else {                        $x = explode(' ', $info['ult_login']);            $x[1] = substr($x[1], 0, -3);                        $x[0] = explode('-', $x[0]);            $x[0] = $x[0][2].'/'.$x[0][1].'/'.$x[0][0];                        $ult_login = $x[0].' às '.$x[1];        }                if($info['tentativas'] > 2) {            $tentativas_color = 'btn-danger';        } else {            $tentativas_color = 'btn-primary';        }                        $html =<<<DADOS                <br>        <form action="#" method="post" onsubmit="adm_usuSalva(); return false;">        	<div class="row">        		<div class="col-12 col-md-4">                	<div class="form-group">                    	<label>Nome:</label>                    	<input type="text" id="nome" name="nome" class="form-control" value="$info[nome]" maxlength="25" required>                    </div>                	<div class="form-group">                    	<label>Sobrenome:</label>                    	<input type="text" id="sobrenome" name="sobrenome" class="form-control" value="$info[sobrenome]" maxlength="25" required>                    </div>                	<div class="form-group">                    	<label>Usuário:</label>                    	<input type="text" id="usuario" name="usuario" class="form-control" value="$info[usuario]" maxlength="25" required>                    </div>        			<div class="form-group">        				<label>Telefone Residencial:</label>        				<input type="text" id="tel_res" name="tel_res" pattern="[0-9]" class="form-control" value="$info[tel_res]" maxlength="10">        			</div>        			<div class="form-group">        				<label>Telefone Celular:</label>        				<input type="text" id="tel_cel" name="tel_cel" pattern="[0-9]" class="form-control" value="$info[tel_cel]" maxlength="11">        			</div>        			<div class="form-group">        				<label>E-mail:</label>        				<input type="email" id="email" name="email" class="form-control" value="$info[email]" maxlength="35">        			</div>        			<div class="form-group">        				<label for="nivel">Nível de acesso:</label>        				<select id="nivel" name="nivel" class="form-control">        					<option value="1" $n0>Solicitante de Hospedagem</option>        					<option value="10" $n1>Responsável da Hospedagem na Cidade</option>        					<option value="20" $n2>Administrador do Sistema</option>        				</select>        			</div>        		</div>        		<div class="col-12 col-md-4">        			<h6><strong>OUTRAS OPERAÇÕES</strong></h6><hr>        			<div class="form-check">                        <label class="form-check-label">                        	<input type="checkbox" class="form-check-input" id="senha_reset" name="senha_reset" value="YES">                        	Resetar senha para o padrão do sistema (123)?                        </label>                    </div>                    <div class="form-check">                        <label class="form-check-label">                        	<input type="checkbox" class="form-check-input" id="login_tentativa" name="login_tentativas" value="YES">                        	Zerar tentativas de login?                        </label>                    </div>                    <br><br>                                        <h6><strong>INFORMAÇÕES</strong></h6><hr>                    <div class="row">                    	<div class="col-6">                    		<button type="button" class="btn $tentativas_color btn-block" style="font-size: 90%" disabled>TENTATIVAS: &nbsp; <span class="badge badge-light">$info[tentativas]</span></button>                    	</div>                    	<div class="col-6">                    		<button type="button" class="btn btn-primary btn-block" style="font-size: 90%" disabled>ACESSOS: &nbsp; <span class="badge badge-light">$info[acessos]</span></button>                    	</div>                    </div><br>                    <div class="row">                    	<div class="col-12">                    		<button type="button" class="btn btn-primary btn-block" disabled>ÚLTIMO LOGIN: &nbsp; <span class="badge badge-light">$ult_login</span></button>                    	</div>                    </div>                            			        		</div>        		<div class="col-12 col-md-4">        			                    <div class="form-group">                        <br>                        <input type="hidden" id="usu_id" name="usu_id" value="$info[id]">                        <button type="submit" class="btn btn-success">Salvar</button>                        <button type="reset" class="btn btn-outline-warning">Resetar</button>                    </div>        		</div>        	</div>                </form>DADOS;                                return $html;    }        public function ListarUsuario()    {        // Solicitantes        $sol_table = '';        $abc = $this->pdo->query('SELECT login.* FROM login WHERE nivel = 1 ORDER BY nome ASC, sobrenome ASC');        while($reg = $abc->fetch(PDO::FETCH_OBJ)) {            $def = $this->pdo->query('SELECT peh.id FROM `peh` LEFT JOIN `cidade` ON `peh`.`congregacao_cidade_id` = `cidade`.`id` WHERE `cidade`.`solicitante_id` = '.$reg->id);            $qtd_pedidos = $def->rowCount();                        $def = $this->pdo->query('SELECT cidade, estado FROM cidade WHERE solicitante_id = '.$reg->id);            $cidade_sol = '';            if($def->rowCount() > 0) {                $cidade_sol = '<ul>';                while($lin = $def->fetch(PDO::FETCH_OBJ)) {                    $cidade_sol .= '<li><span class="badge badge-info">'.$lin->cidade.'/'.$lin->estado.'</span></li> ';                }                $cidade_sol .= '</ul>';            } else {                $cidade_sol = '-';            }                                    $tel_res = $this->FormatTel($reg->tel_res);            $tel_cel = $this->FormatCel($reg->tel_cel);                        $sol_table .=<<<DADOS                                    <tr>                            <td>$reg->nome $reg->sobrenome</td>                            <td><i>$reg->usuario</i></td>                            <td>$tel_res</td>                            <td>$tel_cel</td>                            <td>$reg->email</td>                            <td><span class="badge badge-primary">$qtd_pedidos</span></td>                            <td>$cidade_sol</td>                        </tr>DADOS;        }                unset($cidade_sol, $def, $lin, $tel_cel, $tel_res);                        // Responsáveis        $resp_table = '';        $abc = $this->pdo->query('SELECT login.* FROM login WHERE nivel = 10 ORDER BY nome ASC, sobrenome ASC');        while($reg = $abc->fetch(PDO::FETCH_OBJ)) {            $def = $this->pdo->query('SELECT peh.id FROM `peh` LEFT JOIN `cidade` ON `peh`.`congregacao_cidade_id` = `cidade`.`id` WHERE `cidade`.`resp_id` = '.$reg->id);            $qtd_pedidos = $def->rowCount();                        $def = $this->pdo->query('SELECT fac.id FROM `fac` LEFT JOIN `cidade` ON `fac`.`cidade` = `cidade`.`id` WHERE `cidade`.`resp_id` = '.$reg->id);            $qtd_fac = $def->rowCount();                        $def = $this->pdo->query('SELECT cidade, estado FROM cidade WHERE hospedeiro = 0 AND resp_id = '.$reg->id);            $cidade_sol = '';            if($def->rowCount() > 0) {                $cidade_sol = '<ul>';                while($lin = $def->fetch(PDO::FETCH_OBJ)) {                    $cidade_sol .= '<li><span class="badge badge-info">'.$lin->cidade.'/'.$lin->estado.'</span></li> ';                }                $cidade_sol .= '</ul>';            } else {                $cidade_sol = '-';            }                        $def = $this->pdo->query('SELECT cidade, estado FROM cidade WHERE hospedeiro = 1 AND resp_id = '.$reg->id);            $cidade_resp = '';            if($def->rowCount() > 0) {                $cidade_resp = '<ul>';                while($lin = $def->fetch(PDO::FETCH_OBJ)) {                    $cidade_resp .= '<li><span class="badge badge-dark">'.$lin->cidade.'/'.$lin->estado.'</span></li> ';                }                $cidade_resp .= '</ul>';            } else {                $cidade_resp = '-';            }                        $tel_res = $this->FormatTel($reg->tel_res);            $tel_cel = $this->FormatCel($reg->tel_cel);                        $resp_table .=<<<DADOS                                    <tr>                            <td>$reg->nome $reg->sobrenome</td>                            <td><i>$reg->usuario</i></td>                            <td>$tel_res</td>                            <td>$tel_cel</td>                            <td>$reg->email</td>                            <td class="text-center"><span class="badge badge-primary">$qtd_pedidos</span></td>                            <td class="text-center"><span class="badge badge-dark">$qtd_fac</span></td>                            <td>$cidade_sol</td>                            <td>$cidade_resp</td>                        </tr>DADOS;        }                    unset($cidade_sol, $cidade_resp, $def, $lin, $tel_cel, $tel_res);                        // Administradores        $adm_table = '';        $abc = $this->pdo->query('SELECT login.* FROM login WHERE nivel = 20 ORDER BY nome ASC, sobrenome ASC');        while($reg = $abc->fetch(PDO::FETCH_OBJ)) {                        $tel_res = $this->FormatTel($reg->tel_res);            $tel_cel = $this->FormatCel($reg->tel_cel);                        $adm_table .=<<<DADOS                                    <tr>                            <td>$reg->nome $reg->sobrenome</td>                            <td><i>$reg->usuario</i></td>                            <td>$tel_res</td>                            <td>$tel_cel</td>                            <td>$reg->email</td>                        </tr>DADOS;        }                                        $html =<<<DADOS<!-- CONTEUDO --><div class="container-fluid">	<!-- BREADCRUMB -->	<ul class="breadcrumb">		<li class="breadcrumb-item"><a href="admin.php">Administração</a></li>		<li class="breadcrumb-item active">Listar/Ver Usuário</li>	</ul>	<!-- FIM DO BREADCRUMB -->		<div class="row">		<div class="col-12" id="frame_msg"></div>	</div>    <div class="row">        <div class="col-12">            <h4><strong>LISTAR USUÁRIOS</strong> &nbsp;             <small><button type="button" class="btn btn-sm btn-primary" id="btn_exp" onclick="$('.collapse').addClass('show'); $('#btn_rec').attr('disabled', false); $('#btn_exp').attr('disabled',true);">[+] Expandir tudo</button>            <button type="button" class="btn btn-sm btn-primary" id="btn_rec" disabled onclick="$('.collapse').removeClass('show'); $('#btn_rec').attr('disabled', true); $('#btn_exp').attr('disabled',false);">[-] Recolher tudo</button></small></h4><hr>        </div>    </div>	<div class="row">		<div class="col-12">			<div class="card">				<div class="card-header">					<a data-toggle="collapse" data-target="#sol_panel"><strong>Solicitantes de Hospedagem</strong></a>				</div>				<div class="card-body collapse" id="sol_panel">					<table class="table table-sm table-bordered table-striped">						<thead class="thead-light">							<tr>								<th>Nome</th>								<th>Usuário</th>								<th>Tel. Residencial</th>								<th>Tel. Celular</th>								<th>E-mail</th>								<th>Qtd. de Pedidos</th>                                <th>Designação</th>							</tr>						</thead>						<tbody>						  $sol_table						</tbody>					</table>				</div>			</div>            <br>			<div class="card">				<div class="card-header">					<a data-toggle="collapse" data-target="#resp_panel"><strong>Responsáveis da Hospedagem</strong></a>				</div>				<div class="card-body collapse" id="resp_panel" style="overflow-x: visible;">					<table class="table table-sm table-bordered table-striped">						<thead class="thead-light">							<tr>								<th rowspan="2">Nome</th>								<th rowspan="2">Usuário</th>								<th rowspan="2">Tel. Residencial</th>								<th rowspan="2">Tel. Celular</th>								<th rowspan="2">E-mail</th>								<th rowspan="2" class="text-center"><small><strong>Qtd. de Pedidos</strong></small></th>								<th rowspan="2" class="text-center"><small><strong>Qtd. Acomodações</strong></small></th>                                <th colspan="2" class="text-center">Designações</th>							</tr>							<tr>								<th class="text-center">Cidade Visitante</th>                                <th class="text-center">Cidade com Hospedagem</th>							</tr>						</thead>						<tbody>						  $resp_table						</tbody>					</table>				</div>			</div>            <br>			<div class="card">				<div class="card-header">					<a data-toggle="collapse" data-target="#adm_panel"><strong>Administradores</strong></a>				</div>				<div class="card-body collapse" id="adm_panel">					<table class="table table-sm table-bordered table-striped">						<thead class="thead-light">							<tr>								<th>Nome</th>								<th>Usuário</th>								<th>Tel. Residencial</th>								<th>Tel. Celular</th>								<th>E-mail</th>							</tr>						</thead>						<tbody>						  $adm_table						</tbody>					</table>				</div>			</div>		</div>	</div>	</div>DADOS;                return $html;    }        public function ApagarUsuario()    {        $html =<<<DADOS        <!-- CONTEUDO --><div class="container">	<!-- BREADCRUMB -->	<ul class="breadcrumb">		<li class="breadcrumb-item"><a href="admin.php">Administração</a></li>		<li class="breadcrumb-item active">Apagar Usuário</li>	</ul>	<!-- FIM DO BREADCRUMB -->		<div class="row">		<div class="col-12" id="frame_msg"></div>	</div>    <div class="row">        <div class="col-12">            <h4><strong>APAGAR USUÁRIO</strong></h4><hr>        </div>    </div>            <div class="row">    	<div class="col-12">            <form action="#" method="post" id="escolhe_usu">        		<table class="table table-hover table-sm">        			<thead class="thead-light">        				<tr>        					<th></th>        					<th>Nome</th>        					<th>Usuário</th>        					<th>Nível</th>        					<th>Acessos</th>        					<th>Último Login</th>        				</tr>        			</thead>        			<tbody>    				DADOS;                $abc = $this->pdo->query('SELECT * FROM login WHERE 1 ORDER BY nome ASC, sobrenome ASC');                       while($reg = $abc->fetch(PDO::FETCH_OBJ)) {            $nivel = '';            switch($reg->nivel) {                case 1:                    $nivel = '<span class="badge badge-primary">Solicitante de Hospedagem</span>';                    break;                                    case 10:                    $nivel = '<span class="badge badge-warning">Responsável da Acomodação</span>';                    break;                                    case 20:                    $nivel = '<span class="badge badge-danger">Administrador</span>';                    break;            }                        if($reg->login_data == '0000-00-00 00:00:00') {                // Nunca logou                $data_login = '<span class="badge badge-dark">Nunca logou</span>';            } else {                $data = new DateTime($reg->login_data);                $data_login = '<span class="badge badge-light">'.$data->format('d/m/Y \à\s H:i').'</span>';            }                        // Se a linha exibida for a do usuário, desativa o input.            if($reg->id == $_SESSION['id']) {                $dis = 'disabled';            } else {                $dis = '';            }                                    $html .=<<<DADOS                        <tr>        					<td class="text-center"><input type="radio" name="usu_id" value="$reg->id" $dis onclick="$('tr').removeClass('bg-dark text-white'); $(this).parent().parent().addClass('bg-dark text-white');$('#form_submit').attr('disabled',false); $('#usuid').val($(this).val());"></td>        					<td>$reg->nome $reg->sobrenome</td>        					<td><i>$reg->usuario</i></td>        					<td>$nivel</td>        					<td><span class="badge badge-info">$reg->login_qtd</span></td>        					<td>$data_login</td>        				</tr>DADOS;        }                                $html.=<<<DADOS                    </tbody>        		</table>                <br>                <input type="hidden" id="usuid" value="">                <button type="button" id="form_submit" disabled class="btn btn-danger" onclick="if($('#usuid').val() == ''){\$(this).attr('disabled',true); alert('Escolha um usuário');} else {\$('#escolhe_usu').fadeOut('fast',function(){\$('#ol_confirm').fadeIn('fast');});}">Remover usuário</button>                <button type="reset" class="btn btn-outline-primary" onclick="$('tr').removeClass('bg-dark text-white'); $('#form_submit').attr('disabled',true); $('#usuid').val('');">Desmarcar</button>            </form>    	</div>    </div>    </div><div id="ol_confirm">    <div class="login-page">		<div class="form">			<form class="login-form" id="formulario" action="#" method="post" onsubmit="adm_apagaUsuario(); return false;">				<input name="usuario" id="usuario_confirm" class="no-val" type="text" placeholder="Nome de usuário" autofocus="autofocus" />				<input name="senha" id="senha_confirm" class="no-val" type="password" placeholder="Sua senha"/>				<button type="submit" class="bg-success">confirmar</button>                <div class="text-right">ou <a href="javascript:void(0)" onclick="$('#ol_confirm').fadeOut('fast', function(){\$('#escolhe_usu').fadeIn();});">Cancelar</a></div>				<div id="message" class="message" style="text-align:center">					<div id="message_icon"><span class="glyphicon glyphicon-lamp" style="font-size: 24px;"></span></div>					<div id="message_text"></div>				</div>			</form>		</div>	</div>    </div>DADOS;                        return $html;    }        public function Cidades()    {                $funcao_cidade =<<<DADOS<strong>Hospedagem:</strong> Cidade responsável em acomodar quem vem de fora.<br><strong>Visitante:</strong> Cidade que precisará ser acomodada, pois vem de fora.<br><br><small>Clique em qualquer lugar para fechar</small>DADOS;                $lista_cidade = $this->ListaCidades();        $html=<<<DADOS<!-- CONTEUDO --><div class="container">	<!-- BREADCRUMB -->	<ul class="breadcrumb">		<li class="breadcrumb-item"><a href="admin.php">Administração</a></li>		<li class="breadcrumb-item active">Cidades</li>	</ul>	<!-- FIM DO BREADCRUMB -->		<div class="row">		<div class="col-12" id="frame_msg"></div>	</div>    <div class="row">        <div class="col-12">            <h4><strong><i class="fa fa-globe"></i> &nbsp;CIDADES</strong></h4><hr>        </div>    </div>        <div class="row">    	<div class="col-12 col-md-6 col-lg-5">    		<div class="card">    			<div class="card-header">    				<a data-toggle="collapse" data-target="#cidade_nova"><strong>Nova Cidade</strong></a>    			</div>    			<div class="card-body collapse show" id="cidade_nova">    				<form action="#" method="post" id="form1" onsubmit="return false;">    					<div class="form-group">    						<label for="cidade">Cidade:    						<span class="glyphicon glyphicon-question-sign" style="cursor:pointer" data-toggle="tooltip" title="Nome da cidade"></span></label>    						<input class="form-control" type="text" name="cidade" id="form1_cidade" maxlength="25" required>    					</div>    					<div class="form-group">    						<label for="estado">Estado:</label>    						<select name="estado" id="form1_estado" class="form-control">								<option value="AC">Acre</option>								<option value="AL">Alagoas</option>								<option value="AP">Amapá</option>								<option value="AM">Amazonas</option>								<option value="BA" selected>Bahia</option>								<option value="CE">Ceará</option>								<option value="DF">Distrito Federal</option>								<option value="ES">Espírito Santo</option>								<option value="GO">Goiás</option>								<option value="MA">Maranhão</option>								<option value="MT">Mato Grosso</option>								<option value="MS">Mato Grosso do Sul</option>								<option value="MG">Minas Gerais</option>								<option value="PA">Pará</option>								<option value="PB">Paraíba</option>								<option value="PR">Paraná</option>								<option value="PE">Pernambuco</option>								<option value="PI">Piauí</option>								<option value="RJ">Rio de Janeiro</option>								<option value="RN">Rio Grande do Norte</option>								<option value="RS">Rio Grande do Sul</option>								<option value="RO">Rondônia</option>								<option value="RR">Roraima</option>								<option value="SC">Santa Catarina</option>								<option value="SP">São Paulo</option>								<option value="SE">Sergipe</option>								<option value="TO">Tocantins</option>							</select>    					</div>    					<div class="form-group">    						<label for="hospedeiro">Função da cidade:    						<a href="javascript:void(0)"  data-toggle="popover" data-trigger="focus" title="Função da cidade" data-content="$funcao_cidade" data-placement="right"><span class="glyphicon glyphicon-question-sign"></span></a></label>    						<select class="form-control" name="hospedeiro" id="form1_hospedeiro" required>    							<option value="" disabled="disabled" selected>Escolha:</option>								<option value="1">Hospedagem</option>								<option value="0">Visitante</option>    						</select>    					</div>    					<div class="form-group">    						<button type="button" class="btn btn-success" onclick="adm_cidadeNova()">Cadastrar</button>    					</div>    				</form>    			</div>    		</div>    	</div>    	<div class="col-12 col-md-6 col-lg-7">    		<div class="card">    			<div class="card-header">    				<a data-toggle="collapse" data-target="#lista_cidade"><strong>Lista de Cidades</strong></a>    			</div>    			<div class="card-body collapse" id="lista_cidade" style="padding:0.75rem">    				$lista_cidade    			</div>    		</div>    	</div>    </div>        </div>DADOS;                        return $html;    }        public function ListaCidades()    {        $data_hoje = date('d/m/Y \à\s H:i');                $table_content = '';        $modal_content = '';        $html =<<<DADOS        <h6><small><i>Atualizado em <span class="badge badge-dark">$data_hoje</span></i></small></h6>DADOS;                // CIDADES VISITANTES        $abc = $this->pdo->query('SELECT cidade.*, CONCAT(login.nome, " ", login.sobrenome) AS nome_completo FROM cidade LEFT JOIN login ON cidade.solicitante_id = login.id WHERE cidade.hospedeiro = 0 ORDER BY cidade ASC, estado ASC');        $total = $abc->rowCount();        if($abc->rowCount() > 0) {            $table_content =<<<DADOS        <table class="table table-hover table-sm">            <thead>                <tr>                    <th>Cód.</th>                    <th>Cidade</th>                    <th>Solicitante</th>                    <th></th>                </tr>            </thead>            <tbody>DADOS;                        while($reg = $abc->fetch(PDO::FETCH_OBJ)) {                if($reg->nome_completo == '') {                    $reg->nome_completo = '-';                }                                $table_content.=<<<DADOS                <tr>                    <td>$reg->id</td>                    <td>$reg->cidade/$reg->estado</td>                    <td>$reg->nome_completo</td>                    <td><button type="button" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#ModalConfirm" onclick="$('[id^=\'confirm-\']').hide(); $('#confirm-$reg->id').show(); $('#button_confirm_exc').data('id','$reg->id')"><span class="glyphicon glyphicon-trash"></span></button></td>                </tr>DADOS;                                                                // MODAL                $def = $this->pdo->query('SELECT id FROM peh WHERE peh.congregacao_cidade_id = '.$reg->id);                $modal_str = '';                if($def->rowCount() > 0) {                    $linhas = $def->rowCount();                    $modal_str.=<<<DADOS                    Esta cidade (<i>$reg->cidade/$reg->estado</i>) possui <strong>$linhas</strong> pedido(s) de hospedagem preenchido(s).					<strong>A exclusão desta cidade pode ocasionar erros e instabilidades no sistema.</strong><br><br>					<strong>Deseja prosseguir com a exclusão?</strong>DADOS;                } else {                    $modal_str.=<<<DADOS                                        Esta cidade (<i>$reg->cidade/$reg->estado</i>) ainda não possui pedidos de hospedagem preenchidos.<br><br>					<strong>Deseja prosseguir com a exclusão?</strong>DADOS;                }                                $modal_content .=<<<DADOS                <div id="confirm-$reg->id" style="display:none">                    $modal_str                </div>DADOS;            }                                    $table_content .=<<<DADOS            </tbody>        </table>DADOS;                        unset($abc, $reg);        } else {            $table_content = 'Ainda não há cidades nessa categoria';        }                $html .=<<<DADOS<div class="card">    <div class="card-header bg-info text-white">        <a data-toggle="collapse" data-target="#cid_visitante"><strong>CIDADES VISITANTE</strong> &nbsp;        <span class="badge badge-light">$total</span></a>    </div>    <div class="card-body collapse" id="cid_visitante" style="padding: 0.5rem;">        $table_content    </div></div><br>DADOS;                        // CIDADES HOSPEDEIRAS        $table_content = '';        $abc = $this->pdo->query('SELECT cidade.*, CONCAT(login.nome, " ", login.sobrenome) AS nome_completo FROM cidade LEFT JOIN login ON cidade.resp_id = login.id WHERE cidade.hospedeiro = 1 ORDER BY cidade ASC, estado ASC');        $total = $abc->rowCount();        if($abc->rowCount() > 0) {            $table_content =<<<DADOS                    <table class="table table-hover table-sm">            <thead>                <tr>                    <th>Cód.</th>                    <th>Cidade</th>                    <th>Responsável</th>                    <th></th>                </tr>            </thead>            <tbody>DADOS;                        while($reg = $abc->fetch(PDO::FETCH_OBJ)) {                if($reg->nome_completo == '') {                    $reg->nome_completo = '-';                }                                $table_content.=<<<DADOS                                <tr>                    <td>$reg->id</td>                    <td>$reg->cidade/$reg->estado</td>                    <td>$reg->nome_completo</td>                    <td><button type="button" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#ModalConfirm" onclick="$('[id^=\'confirm-\']').hide(); $('#confirm-$reg->id').show(); $('#button_confirm_exc').data('id','$reg->id')"><span class="glyphicon glyphicon-trash"></span></button></td>                </tr>DADOS;                                                // MODAL                $def = $this->pdo->query('SELECT id FROM fac WHERE fac.cidade = '.$reg->id);                $modal_str = '';                if($def->rowCount() > 0) {                    $linhas = $def->rowCount();                    $modal_str.=<<<DADOS                                        Esta cidade (<i>$reg->cidade/$reg->estado</i>) possui <strong>$linhas</strong> formulário(s) de acomodação preenchido(s).					<strong>A exclusão desta cidade pode ocasionar erros e instabilidades no sistema.</strong><br><br>					<strong>Deseja prosseguir com a exclusão?</strong>DADOS;                } else {                    $modal_str.=<<<DADOS                                        Esta cidade (<i>$reg->cidade/$reg->estado</i>) ainda não possui formulários de acomodação preenchidos.<br><br>					<strong>Deseja prosseguir com a exclusão?</strong>DADOS;                }                                $modal_content .=<<<DADOS                                <div id="confirm-$reg->id" style="display:none">                    $modal_str                </div>DADOS;            }                                    $table_content .=<<<DADOS                        </tbody>        </table>DADOS;                        unset($abc, $reg);        } else {            $table_content = 'Ainda não há cidades nessa categoria';        }                $html .=<<<DADOS        <div class="card">    <div class="card-header bg-info text-white">        <a data-toggle="collapse" data-target="#cid_hospedeira"><strong>CIDADES HOSPEDEIRA &nbsp;        <span class="badge badge-light">$total</span></strong></a>    </div>    <div class="card-body collapse" id="cid_hospedeira" style="padding: 0.5rem;">        $table_content    </div></div>DADOS;                unset($table_content);                /*         * CRIA MODAL DE CONFIRMAÇÃO DE EXCLUSÃO         */                                                $html.=<<<DADOS<!-- Modal 1 --><div id="ModalConfirm" class="modal fade" role="dialog">	<div class="modal-dialog">		<!-- Modal content-->		<div class="modal-content">			<div class="modal-header">				<h4 class="modal-title">Confirmar exclusão da cidade?</h4>				<button type="button" class="close" data-dismiss="modal">&times;</button>			</div>			<div class="modal-body">                $modal_content            </div>            <div class="modal-footer">                <button type="button" class="btn btn-success" data-id="0" id="button_confirm_exc" onclick="adm_apagaCidade();">Confirmar e apagar</button> ou                <button type="button" class="btn btn-outline-secondary" data-dismiss="modal" onclick="$('button_confirm_exc').data('id', '0');">Cancelar</button>            </div>        </div>    </div></div>DADOS;                                                return $html;    }        public function Designacoes()    {                // Captura lista de todos os usuários do banco de dados e armazena em array        $lista_grupo = array();        $lista_usu = array();                $def = $this->pdo->query('SELECT * FROM login WHERE 1 ORDER BY nivel ASC, nome ASC, sobrenome ASC');        while($lin = $def->fetch(PDO::FETCH_OBJ)){            $lista_grupo = array(                'id' => $lin->id,                'nome' => $lin->nome.' '.$lin->sobrenome,                'nivel' => $lin->nivel            );            array_push($lista_usu, $lista_grupo);        }                unset($lista_grupo, $def, $lin);                                                // Cidade com hospedagem                $table_hosp = '';        $sem_resp = 0;        $abc = $this->pdo->query('SELECT cidade.*, CONCAT(login.nome," ", login.sobrenome) AS resp FROM cidade LEFT JOIN login ON cidade.resp_id = login.id WHERE cidade.hospedeiro = 1 ORDER BY cidade.cidade ASC');        if($abc->rowCount() == 0) {            $table_hosp = '<tr><td colspan="3">Não há cidades nessa categoria</td></tr>';        } else {            while($reg = $abc->fetch(PDO::FETCH_OBJ)) {                // Verifica se tem responsável                if($reg->resp == '') {                    $sem_resp++;                    $reg->resp = '<span class="badge badge-warning"><i>VAZIO</i></span>';                }                                                $x = $reg->resp_id; // ID do responsável da cidade                $select = '<option value="0">Escolha</option>';                $optgroup = 0;                                foreach($lista_usu as $usu) { // Varre ARRAY de usuário                    if((int)$usu['nivel'] >= 10) { // Somente nível superior ao 10.                        if($optgroup == 0) {                            switch($usu['nivel']) {                                case '1':                                    $select .= '<optgroup label="Solicitante de Hospedagem">';                                    break;                                                                    case '10':                                    $select .= '<optgroup label="Responsável da Hospedagem na Cidade">';                                    break;                                                                    case '20':                                    $select .= '<optgroup label="Administrador">';                                    break;                            }                                                        $optgroup = $usu['nivel'];                        } else if ($optgroup != $usu['nivel']) {                            $select .= '</optgroup>';                                                        switch($usu['nivel']) {                                case '1':                                    $select .= '<optgroup label="Solicitante de Hospedagem">';                                    break;                                                                    case '10':                                    $select .= '<optgroup label="Responsável da Hospedagem na Cidade">';                                    break;                                                                    case '20':                                    $select .= '<optgroup label="Administrador">';                                    break;                            }                                                        $optgroup = $usu['nivel'];                        }                                                                        if($x == $usu['id']) {                            $select .= '<option value="'.$usu['id'].'" selected>'.$usu['nome'].'</option>';                        } else {                            $select .= '<option value="'.$usu['id'].'">'.$usu['nome'].'</option>';                        }                    }                                    }                                $select .= '</optgroup>';                                $table_hosp .= <<<DADOS                            <tr>								<td>$reg->id</td>								<td>$reg->cidade/$reg->estado</td>								<td>    								<div id="hosp_resp-$reg->id">        								<span>$reg->resp</span>        								<button type="button" class="btn btn-outline-success btn-sm float-right" onclick="$('#hosp_resp-$reg->id').slideUp();$('#hosp_resp_sel-$reg->id').slideDown();"><span class="glyphicon glyphicon-edit"</span></button>                                    </div>                                    <div id="hosp_resp_sel-$reg->id" style="display:none">                                        <form class="form-inline">                                            <div class="form-group">                                                <select class="form-control mr-sm-2">                                                    $select                                                </select>                                            </div>                                            <div class="form-group">                                                <button type="button" class="btn btn-outline-dark btn-sm mr-sm-2" onclick="adm_designaResp($reg->id, $('#hosp_resp_sel-$reg->id select').find(':selected').val(), \$(this));">Salvar</button>                                                 <button type="button" class="btn btn-outline-dark btn-sm mr-sm-2" onclick="$('#hosp_resp_sel-$reg->id').slideUp();$('#hosp_resp-$reg->id').slideDown();">Cancelar</button>                                            </div>                                                                                </form>                                    </div>                                </td>							</tr>DADOS;            }        }                                        // Cidade visitante        $table_visit = '';        $sem_resp_sol = 0;        $abc = $this->pdo->query('SELECT cidade.*, (SELECT CONCAT(login.nome, " ", login.sobrenome) FROM login WHERE login.id = cidade.solicitante_id) AS solicitante, CONCAT(login.nome, " ", login.sobrenome) AS resp FROM cidade LEFT JOIN login ON cidade.resp_id = login.id WHERE cidade.hospedeiro = 0 ORDER BY cidade.cidade ASC');        if($abc->rowCount() == 0) {            $table_visit = '<tr><td colspan="4">Não há cidades nessa categoria</td></tr>';        } else {            while($reg = $abc->fetch(PDO::FETCH_OBJ)) {                                // Verifica se ambos os campos estão vazios                if($reg->solicitante == '' && $reg->resp == '') {                    $sem_resp_sol++;                    $reg->solicitante = '<span class="badge badge-warning"><i>VAZIO</i></span>';                    $reg->resp = '<span class="badge badge-warning"><i>VAZIO</i></span>';                } else if($reg->resp == '') { // Verifica se tem responsável                    $sem_resp_sol++;                    $reg->resp = '<span class="badge badge-warning"><i>VAZIO</i></span>';                } else if($reg->solicitante == '') { // Verifica se tem solicitante                    $sem_resp_sol++;                    $reg->solicitante = '<span class="badge badge-warning"><i>VAZIO</i></span>';                }                                                $x = $reg->resp_id; // ID do responsável da cidade                $select = '<option value="0">Escolha</option>';                $optgroup = 0;                                foreach($lista_usu as $usu) { // Varre ARRAY de usuário                    if((int)$usu['nivel'] >= 10) { // Somente nível superior ao 10.                        if($optgroup == 0) {                            switch($usu['nivel']) {                                case '1':                                    $select .= '<optgroup label="Solicitante de Hospedagem">';                                    break;                                                                    case '10':                                    $select .= '<optgroup label="Responsável da Hospedagem na Cidade">';                                    break;                                                                    case '20':                                    $select .= '<optgroup label="Administrador">';                                    break;                            }                                                        $optgroup = $usu['nivel'];                        } else if ($optgroup != $usu['nivel']) {                            $select .= '</optgroup>';                                                        switch($usu['nivel']) {                                case '1':                                    $select .= '<optgroup label="Solicitante de Hospedagem">';                                    break;                                                                    case '10':                                    $select .= '<optgroup label="Responsável da Hospedagem na Cidade">';                                    break;                                                                    case '20':                                    $select .= '<optgroup label="Administrador">';                                    break;                            }                                                        $optgroup = $usu['nivel'];                        }                                                                        if($x == $usu['id']) {                            $select .= '<option value="'.$usu['id'].'" selected>'.$usu['nome'].'</option>';                        } else {                            $select .= '<option value="'.$usu['id'].'">'.$usu['nome'].'</option>';                        }                    }                                    }                                $select .= '</optgroup>';                                                /*                 * ############################################################                 */                                                $x = $reg->solicitante_id; // ID do solicitante da cidade                $select_sol = '<option value="0">Escolha</option>';                $optgroup = 0;                                foreach($lista_usu as $usu) { // Varre ARRAY de usuário                    if((int)$usu['nivel'] < 10) { // Somente nível inferior ao 10.                        if($optgroup == 0) {                            switch($usu['nivel']) {                                case '1':                                    $select .= '<optgroup label="Solicitante de Hospedagem">';                                    break;                                                                    case '10':                                    $select .= '<optgroup label="Responsável da Hospedagem na Cidade">';                                    break;                                                                    case '20':                                    $select .= '<optgroup label="Administrador">';                                    break;                            }                                                        $optgroup = $usu['nivel'];                        } else if ($optgroup != $usu['nivel']) {                            $select_sol .= '</optgroup>';                                                        switch($usu['nivel']) {                                case '1':                                    $select .= '<optgroup label="Solicitante de Hospedagem">';                                    break;                                                                    case '10':                                    $select .= '<optgroup label="Responsável da Hospedagem na Cidade">';                                    break;                                                                    case '20':                                    $select .= '<optgroup label="Administrador">';                                    break;                            }                                                        $optgroup = $usu['nivel'];                        }                                                                        if($x == $usu['id']) {                            $select_sol .= '<option value="'.$usu['id'].'" selected>'.$usu['nome'].'</option>';                        } else {                            $select_sol .= '<option value="'.$usu['id'].'">'.$usu['nome'].'</option>';                        }                    }                                    }                                $select_sol .= '</optgroup>';                                                                                                                $table_visit .= <<<DADOS							<tr>								<td>$reg->id</td>								<td>$reg->cidade/$reg->estado</td>								<td>    								<div id="vis_sol-$reg->id">        								<span>$reg->solicitante</span>        								<button type="button" class="btn btn-outline-success btn-sm float-right" onclick="$('#vis_sol-$reg->id').slideUp(); $('#vis_sol_sel-$reg->id').slideDown();"><span class="glyphicon glyphicon-edit"</span></button>                                    </div>                                    <div id="vis_sol_sel-$reg->id" style="display:none">                                        <form class="form-inline">                                            <div class="form-group">                                                <select class="form-control mr-sm-2">                                                    $select_sol                                                </select>                                            </div>                                            <div class="form-group">                                                <button type="button" class="btn btn-outline-dark btn-sm mr-sm-2" onclick="adm_designaSol($reg->id, $('#vis_sol_sel-$reg->id select').find(':selected').val(), \$(this));">Salvar</button>                                                <button type="button" class="btn btn-outline-dark btn-sm mr-sm-2" onclick="$('#vis_sol_sel-$reg->id').slideUp(); $('#vis_sol-$reg->id').slideDown();">Cancelar</button>                                            </div>                                                                                    </form>                                    </div>                                </td>								<td>    								<div id="vis_resp-$reg->id">        								<span>$reg->resp</span>        								<button type="button" class="btn btn-outline-success btn-sm float-right" onclick="$('#vis_resp-$reg->id').slideUp(); $('#vis_resp_sel-$reg->id').slideDown();"><span class="glyphicon glyphicon-edit"</span></button>                                    </div>                                    <div id="vis_resp_sel-$reg->id" style="display:none">                                        <form class="form-inline">                                            <div class="form-group">                                                <select class="form-control mr-sm-2">                                                    $select                                                </select>                                            </div>                                            <div class="form-group">                                                <button type="button" class="btn btn-outline-dark btn-sm mr-sm-2" onclick="adm_designaResp($reg->id, $('#vis_resp_sel-$reg->id select').find(':selected').val(), \$(this));">Salvar</button>                                                <button type="button" class="btn btn-outline-dark btn-sm mr-sm-2" onclick="$('#vis_resp_sel-$reg->id').slideUp(); $('#vis_resp-$reg->id').slideDown();">Cancelar</button>                                            </div>                                                                                    </form>                                    </div>								</td>							</tr>DADOS;            }        }                                $html=<<<DADOS        <!-- CONTEUDO --><div class="container">	<!-- BREADCRUMB -->	<ul class="breadcrumb">		<li class="breadcrumb-item"><a href="admin.php">Administração</a></li>		<li class="breadcrumb-item active">Designações</li>	</ul>	<!-- FIM DO BREADCRUMB -->		<div class="row">		<div class="col-12" id="frame_msg"></div>	</div>	    <div class="row">        <div class="col-12">            <h4><strong><i class="fa fa-globe"></i> &nbsp;DESIGNAÇÕES</strong></h4><hr>        </div>    </div>    <div class="row">		<div class="col-12 offset-lg-2 col-lg-8">			<div class="card">				<div class="card-header bg-primary text-white">					<a data-toggle="collapse" data-target="#cidade_hospedeira"><strong>CIDADES COM HOSPEDAGEM</strong></a>				</div>				<div class="card-body collapse" id="cidade_hospedeira" style="padding: 0.75rem">					<table class="table table-bordered table-sm">						<thead>							<tr>								<th>Cód.</th>								<th>Cidade</th>								<th>Responsável</th>							</tr>						</thead>						<tbody>							<tr>								<td></td>								<td></td>								<td></td>							</tr>                            $table_hosp						</tbody>					</table>				</div>			</div>		</div>    </div>    <br>    <div class="row">		<div class="col-12 offset-lg-2 col-lg-8">			<div class="card">				<div class="card-header bg-primary text-white">					<a data-toggle="collapse" data-target="#cidade_visitante"><strong>CIDADES VISITANTES</strong></a>				</div>				<div class="card-body collapse" id="cidade_visitante" style="padding: 0.75rem">					<table class="table table-bordered table-sm">						<thead>							<tr>								<th>Cód.</th>								<th>Cidade</th>								<th>Solicitante</th>								<th>Responsável</th>							</tr>						</thead>						<tbody>							<tr>								<td></td>								<td></td>								<td></td>								<td></td>							</tr>                            $table_visit						</tbody>					</table>				</div>			</div>		</div>    </div></div>DADOS;                        return $html;    }        public function Redefinir()    {                $html =<<<DADOS<!-- CONTEUDO --><div class="container">	<!-- BREADCRUMB -->	<ul class="breadcrumb">		<li class="breadcrumb-item"><a href="admin.php">Administração</a></li>		<li class="breadcrumb-item active">Redefinir</li>	</ul>	<!-- FIM DO BREADCRUMB -->		<div class="row">		<div class="col-12" id="frame_msg"></div>	</div>    <div class="row">        <div class="col-12">            <h4><strong><i class="fa fa-repeat"></i> &nbsp;REDEFINIR SISTEMA</strong></h4><hr>        </div>    </div>	<div class="row">		<div class="col-12 col-md-10 col-lg-8">			<div class="card">				<div class="card-body">    				<strong>Atenção:</strong> Nenhum formulário será apagado!<hr>    				<form method="post" action="#" onsubmit="adm_redefinir(); return false;">                        <div class="form-check">                        	<label class="form-check-label">                        		<input type="checkbox" id="opt1" class="form-check-input" value="Y"> Desvincular PEH e FAC                        	</label>                        	&nbsp; &nbsp;<a href="javascript:void(0)" data-toggle="popover" data-trigger="focus" data-content="Essa opção remove o vínculo entre os pedidos e as acomodações que foram realizados em algum evento anterior. Ao fazer isso, todos os solicitantes e responsáveis verão seus pedidos e acomodações livres para um novo vínculo." title="Desvincular PEH e FAC">[Entenda isso]</a>                        </div>                                                <div class="form-check">                        	<label class="form-check-label">                        		<input type="checkbox" id="opt2" class="form-check-input" value="Y"> Colocar todos PEH em revisão                        	</label>                        	&nbsp; &nbsp;<a href="javascript:void(0)" data-toggle="popover" data-trigger="focus" data-content="Ao colocar o PEH em revisão, o solicitante que preencheu aquela PEH receberá a informação de que precisa revisar e liberar o pedido para ser atendido novamente.<br><br><strong>Por que é importante?</strong> Ao ser revisado, o solicitante pode verificar se os ocupantes permanecem os mesmos, as idades, o parentesco, também as datas e outras informações que podem ser diferentes do último evento. Revisar um PEH é mais fácil que fazer um novo, economizando assim um tempo valioso." title="PEH em revisão">[Entenda isso]</a>                        </div>                                                <div class="form-check">                        	<label class="form-check-label">                        		<input type="checkbox" id="opt3" class="form-check-input" value="Y"> Colocar todos FAC em revisão                        	</label>                        	&nbsp; &nbsp;<a href="javascript:void(0)" data-toggle="popover" data-trigger="focus" data-content="Ao colocar o FAC em revisão, o responsável que preencheu aquele FAC receberá a informação de que precisa revisar e liberar a acomodação para atender pedidos novamente.<br><br><strong>Por que é importante?</strong> Ao ser revisado, o responsável pode verificar se a casa ainda está disponível ou se a situação dos quartos, dos valores ou dos hospedeiros mudou, também as datas e outras informações que podem ser diferentes do último evento. Revisar um FAC é mais fácil que fazer um novo, economizando assim um tempo valioso." title="FAC em revisão">[Entenda isso]</a>                        </div>                                                <br><hr>                        <div class="form-group">                        	<strong>ADICIONAL:</strong>                        </div>                                                <div class="form-check">                        	<label class="form-check-label">                        		<input type="checkbox" id="opt4" class="form-check-input" value="Y"> Apagar as datas da primeira e última noite do PEH                        	</label>                        	&nbsp; &nbsp;<a href="javascript:void(0)" data-toggle="popover" data-trigger="focus" data-content="Se as datas que constam no PEH referem-se a um evento que já passou e precisa ser atualizado, o sistema faz essa 'limpa' automaticamente.<br><br> <strong>Por que é importante?</strong> PEH com datas erradas pode causar constrangimento e uma falha de organização. Por isso, certifique-se de apagar todas as datas para os solicitantes revisarem e inserir novas." title="Apagar datas do PEH">[Entenda isso]</a>                        </div>                                                <div class="form-check">                        	<label class="form-check-label">                        		<input type="checkbox" id="opt5" class="form-check-input" value="Y"> Apagar o campo "<i>Cidade do Congresso</i>" do PEH                        	</label>                        	&nbsp; &nbsp;<a href="javascript:void(0)" data-toggle="popover" data-trigger="focus" data-content="Esse campo informa onde será realizado o evento (coongresso ou assembleia) para o qual o PEH foi solicitado.<br><br> <strong>Por que é importante?</strong> É bastante útil para que os hóspedes saibam como será a rotina dos visitantes, também a distância que levará da hospedagem até o local do evento e assim auxiliar os visitante na programação durante a estadia." title="Cidade do Congresso">[Entenda isso]</a>                        </div>                                                <br>                        <div class="form-group">                        	<button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-ok"></span> Confirmar</button>                        </div>    				</form>    				<br>    				<small><strong>* PEH:</strong> Pedido Especial de Hospedagem</small> <br>    				<small><strong>* FAC:</strong> Formulário de Acomodação</small>				</div>			</div>		</div>	</div></div>DADOS;                ?>        <?php                return $html;    }        public function RelatorioGeral()    {        $html = '';        /*         * ####################################################         *         *              CÓDIGO GERADOR DE GRÁFICOS         *         * ###################################################         */                                        // GRAFICO 1        $abc = $this->pdo->query('SELECT cidade.*, (SELECT COUNT(peh.id) FROM peh WHERE peh.congregacao_cidade_id = cidade.id) AS peh_total FROM cidade WHERE hospedeiro = 0 ORDER BY cidade ASC');                $labels1 = '';        $data1 = '';                        while($reg = $abc->fetch(PDO::FETCH_OBJ)) {            $labels1 .= "'".$reg->cidade."/".$reg->estado."',";            $data1 .= $reg->peh_total.', ';                    }        $labels1 = substr($labels1, 0, -1);        $data1 = substr($data1, 0, -2);                        // GRAFICO 2        $abc = $this->pdo->query('SELECT cidade.*, (SELECT COUNT(fac.id) FROM fac WHERE fac.cidade = cidade.id) AS fac_total FROM cidade WHERE hospedeiro = 1 ORDER BY cidade ASC');                $labels2 = '';        $data2 = '';                while($reg = $abc->fetch(PDO::FETCH_OBJ)) {            $labels2 .= "'".$reg->cidade."/".$reg->estado."',";            $data2 .= $reg->fac_total.', ';                    }        $labels2 = substr($labels2, 0, -1);        $data2 = substr($data2, 0, -2);                        // GRAFICO 3        $abc = $this->pdo->query('SELECT peh.* FROM peh WHERE 1');                $labels3 = "'menores de 18', '18 a 25', '26 a 35', '36 a 45', '46 a 55', '56 a 65', 'maiores de 65'";        $data3 = '';                $idade[0] = 0; // menores de 18        $idade[1] = 0; // 18 a 25        $idade[2] = 0; // 26 a 35        $idade[3] = 0; // 36 a 45        $idade[4] = 0; // 46 a 55        $idade[5] = 0; // 56 a 65        $idade[6] = 0; // maiores de 65                while($reg = $abc->fetch(PDO::FETCH_OBJ)) {            if($reg->oc1_nome != '') {                if($reg->oc1_idade < 18) {                    $idade[0] +=1;                } else if($reg->oc1_idade >= 18 && $reg->oc1_idade < 25) {                    $idade[1] +=1;                } else if($reg->oc1_idade >= 25 && $reg->oc1_idade < 35) {                    $idade[2] +=1;                } else if($reg->oc1_idade >= 35 && $reg->oc1_idade < 45) {                    $idade[3] +=1;                } else if($reg->oc1_idade >= 45 && $reg->oc1_idade < 55) {                    $idade[4] +=1;                } else if($reg->oc1_idade >= 55 && $reg->oc1_idade < 65) {                    $idade[5] +=1;                } else {                    $idade[6] +=1;                }            }                        if($reg->oc2_nome != '') {                if($reg->oc2_idade < 18) {                    $idade[0] +=1;                } else if($reg->oc2_idade >= 18 && $reg->oc2_idade < 25) {                    $idade[1] +=1;                } else if($reg->oc2_idade >= 25 && $reg->oc2_idade < 35) {                    $idade[2] +=1;                } else if($reg->oc2_idade >= 35 && $reg->oc2_idade < 45) {                    $idade[3] +=1;                } else if($reg->oc2_idade >= 45 && $reg->oc2_idade < 55) {                    $idade[4] +=1;                } else if($reg->oc2_idade >= 55 && $reg->oc2_idade < 65) {                    $idade[5] +=1;                } else {                    $idade[6] +=1;                }            }                        if($reg->oc3_nome != '') {                if($reg->oc3_idade < 18) {                    $idade[0] +=1;                } else if($reg->oc3_idade >= 18 && $reg->oc3_idade < 25) {                    $idade[1] +=1;                } else if($reg->oc3_idade >= 25 && $reg->oc3_idade < 35) {                    $idade[2] +=1;                } else if($reg->oc3_idade >= 35 && $reg->oc3_idade < 45) {                    $idade[3] +=1;                } else if($reg->oc3_idade >= 45 && $reg->oc3_idade < 55) {                    $idade[4] +=1;                } else if($reg->oc3_idade >= 55 && $reg->oc3_idade < 65) {                    $idade[5] +=1;                } else {                    $idade[6] +=1;                }            }                        if($reg->oc4_nome != '') {                if($reg->oc4_idade < 18) {                    $idade[0] +=1;                } else if($reg->oc4_idade >= 18 && $reg->oc4_idade < 25) {                    $idade[1] +=1;                } else if($reg->oc4_idade >= 25 && $reg->oc4_idade < 35) {                    $idade[2] +=1;                } else if($reg->oc4_idade >= 35 && $reg->oc4_idade < 45) {                    $idade[3] +=1;                } else if($reg->oc4_idade >= 45 && $reg->oc4_idade < 55) {                    $idade[4] +=1;                } else if($reg->oc4_idade >= 55 && $reg->oc4_idade < 65) {                    $idade[5] +=1;                } else {                    $idade[6] +=1;                }            }        }                $data3 = implode(',', $idade);                                                $html.=<<<DADOS        <script>var labelsCtx1 = [$labels1];var dataCtx1 = [$data1];var labelsCtx2 = [$labels2];var dataCtx2 = [$data2];var labelsCtx3 = [$labels3];var dataCtx3 = [$data3];</script>DADOS;                        unset($labels1, $data1, $labels2, $data2, $labels3, $data3, $idade);                /*         * ####################################################         *         *           FIM DO CÓDIGO GERADOR DE GRÁFICOS         *         * ###################################################         */                                // Pedidos vs Acomodações        $ped_total = 0;        $ped_pessoas = 0;        $ped_revisao = 0;        $ped_atendidos = 0;        $ped_masc = 0;        $ped_fem = 0;        $ped_hotel = 0;                                $fac_total = 0;        $fac_revisao = 0;        $fac_atendidos = 0;        $fac_excelente = 0;        $fac_boa = 0;        $fac_razoavel = 0;                $abc = $this->pdo->query('SELECT * FROM peh WHERE 1');        $ped_total = $abc->rowCount();        while($reg = $abc->fetch(PDO::FETCH_OBJ)) {            if($reg->revisar == true) { // Em revisão                $ped_revisao++;            }                        if($reg->fac_id != 0) { // Atendidos                $ped_atendidos++;            }                        if($reg->oc1_sexo == 'M') {                $ped_masc++;                $ped_pessoas++;            } else if($reg->oc1_sexo == 'F') {                $ped_fem++;                $ped_pessoas++;            }                         if($reg->oc2_sexo == 'M') {                $ped_masc++;                $ped_pessoas++;            } else if($reg->oc2_sexo == 'F') {                $ped_fem++;                $ped_pessoas++;            }                         if($reg->oc3_sexo == 'M') {                $ped_masc++;                $ped_pessoas++;            } else if($reg->oc3_sexo == 'F') {                $ped_fem++;                $ped_pessoas++;            }                         if($reg->oc4_sexo == 'M') {                $ped_masc++;                $ped_pessoas++;            } else if($reg->oc4_sexo == 'F') {                $ped_fem++;                $ped_pessoas++;            }                         if($reg->tipo_hospedagem == 'hotel') {                $ped_hotel++;            }        }                        $abc = $this->pdo->query('SELECT fac.*, peh.id AS pehid FROM fac LEFT JOIN peh ON fac.id = peh.fac_id WHERE 1');        $fac_total = $abc->rowCount();        while($reg = $abc->fetch(PDO::FETCH_OBJ)) {            if($reg->revisar == true) { // Em revisão                $fac_revisao++;            }                        if($reg->pehid > 0) { // Atendidos                $fac_atendidos++;            }                        switch($reg->condicao) {                case 'boa':                    $fac_boa++;                    break;                                    case 'excelente':                    $fac_excelente++;                    break;                                    case 'razoavel':                    $fac_razoavel++;                    break;            }        }                //Trata dados        if($ped_revisao >= ($ped_total*0.75)) {            $ped_revisao_str = '<span class="badge badge-danger" data-toggle="tooltip" title="Valor superior a 75% do total.">'.$ped_revisao.'</span>';        } else if($ped_revisao >= ($ped_total * 0.5)) {            $ped_revisao_str = '<span class="badge badge-warning" data-toggle="tooltip" title="Valor superior a 50% do total.">'.$ped_revisao.'</span>';        } else {            $ped_revisao_str = '<span class="badge badge-info" data-toggle="tooltip" title="Valor inferior a 50% do total.">'.$ped_revisao.'</span>';        }                if($ped_atendidos >= ($ped_total*0.75)) {            $ped_atendidos_str = '<span class="badge badge-info" data-toggle="tooltip" title="Valor igual a '.($ped_atendidos*100)/$ped_total.'% do total.">'.$ped_atendidos.'</span>';        } else if($ped_atendidos >= ($ped_total*0.5)) {            $ped_atendidos_str = '<span class="badge badge-warning" data-toggle="tooltip" title="Valor igual a '.($ped_atendidos*100)/$ped_total.'% do total.">'.$ped_atendidos.'</span>';        } else {            $ped_atendidos_str = '<span class="badge badge-danger" data-toggle="tooltip" title="Valor igual a '.($ped_atendidos*100)/$ped_total.'% do total.">'.$ped_atendidos.'</span>';        }                if($fac_revisao >= ($fac_total*0.75)) {            $fac_revisao_str = '<span class="badge badge-danger" data-toggle="tooltip" title="Valor superior a 75% do total.">'.$fac_revisao.'</span>';        } else if($fac_revisao >= ($fac_total * 0.5)) {            $fac_revisao_str = '<span class="badge badge-warning" data-toggle="tooltip" title="Valor superior a 50% do total.">'.$fac_revisao.'</span>';        } else {            $fac_revisao_str = '<span class="badge badge-info" data-toggle="tooltip" title="Valor inferior a 50% do total.">'.$fac_revisao.'</span>';        }                                        // Usuários        $total_sol = 0;        $total_resp = 0;        $total_adm = 0;                $abc = $this->pdo->query('SELECT id FROM login WHERE nivel = 1');        $total_sol = $abc->rowCount();                $abc = $this->pdo->query('SELECT id FROM login WHERE nivel = 10');        $total_resp = $abc->rowCount();                $abc = $this->pdo->query('SELECT id FROM login WHERE nivel = 20');        $total_adm = $abc->rowCount();                                // Cidades        $cid_vis = 0;        $cid_hosp = 0;        $cid_sem_sol = 0;        $cid_sem_resp = 0;        $cid_total = 0;                $abc = $this->pdo->query('SELECT id FROM cidade WHERE hospedeiro = 0'); // Visitante        $cid_vis = $abc->rowCount();                $abc = $this->pdo->query('SELECT id FROM cidade WHERE hospedeiro = 1'); // Hospedeira        $cid_hosp = $abc->rowCount();                $cid_total = $cid_hosp + $cid_vis; // Total de cidades                $abc = $this->pdo->query('SELECT id FROM cidade WHERE hospedeiro = 0 AND solicitante_id = 0'); // Sem solicitante        $cid_sem_sol = $abc->rowCount();                $abc = $this->pdo->query('SELECT id FROM cidade WHERE resp_id = 0'); // Sem responsável        $cid_sem_resp = $abc->rowCount();                if($cid_sem_sol == 0) {            $cid_sem_sol_str = '<span class="badge badge-success" data-toggle="tooltip" title="Todas as cidades com seus solicitantes designados.">'.$cid_sem_sol.'</span>';        } else if($cid_sem_sol <= ($cid_vis * 0.5)) {            $cid_sem_sol_str = '<span class="badge badge-warning" data-toggle="tooltip" title="'.($cid_sem_sol * 100)/$cid_vis.'% das cidades sem solicitante.">'.$cid_sem_sol.'</span>';        } else {            $cid_sem_sol_str = '<span class="badge badge-danger" data-toggle="tooltip" title="'.($cid_sem_sol * 100)/$cid_vis.'% das cidades sem solicitante.">'.$cid_sem_sol.'</span>';        }                if($cid_sem_resp == 0) {            $cid_sem_resp_str = '<span class="badge badge-success" data-toggle="tooltip" title="Todas as cidades com seus responsáveis designados.">'.$cid_sem_resp.'</span>';        } else if($cid_sem_resp <= ($cid_total * 0.5)) {            $cid_sem_resp_str = '<span class="badge badge-warning" data-toggle="tooltip" title="'.($cid_sem_resp * 100)/$cid_total.'% das cidades sem solicitante.">'.$cid_sem_resp.'</span>';        } else {            $cid_sem_resp_str = '<span class="badge badge-danger" data-toggle="tooltip" title="'.($cid_sem_resp * 100)/$cid_total.'% das cidades sem solicitante.">'.$cid_sem_resp.'</span>';        }                $data_hoje = date('d/m/Y \à\s H:i');                        $html .= <<<DADOS<!-- CONTEUDO --><div class="container-fluid">	<!-- BREADCRUMB -->	<ul class="breadcrumb">		<li class="breadcrumb-item"><a href="admin.php">Administração</a></li>		<li class="breadcrumb-item active">Relatório</li>	</ul>	<!-- FIM DO BREADCRUMB -->		<div class="row">		<div class="col-12" id="frame_msg"></div>	</div>    <div class="row">        <div class="col-12">            <h4><strong>RELATÓRIO GERAL <small><small>(gerado em $data_hoje)            <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" title="Não gere vários relatórios em períodos curtos, pois consome recursos do sistema. O ideal é gerar 2 relatórios por dia."></span></small></small></strong> &nbsp;             <small><button type="button" class="btn btn-sm btn-primary" id="btn_exp" onclick="$('.collapse').addClass('show'); $('#btn_rec').attr('disabled', false); $('#btn_exp').attr('disabled',true);">[+] Expandir tudo</button>            <button type="button" class="btn btn-sm btn-primary" id="btn_rec" disabled onclick="$('.collapse').removeClass('show'); $('#btn_rec').attr('disabled', true); $('#btn_exp').attr('disabled',false);">[-] Recolher tudo</button></small></h4><hr>        </div>    </div>	<div class="row">		<div class="col-12 col-md-12 col-lg-4">			<div class="card">        		<div class="card-header">        			<a data-toggle="collapse" data-target="#panel1"><strong>Pedidos vs. Acomodações</strong></a>        		</div>        		<div class="card-body collapse" id="panel1">                    <div class="row" style="font-size: 95%;">                        <div class="col-6">                            <div class="card bg-dark text-white">                                <div class="card-body text-center">                                    <strong>TOTAL DE PEH </strong><br>                                    <span class="badge badge-light" style="font-size:100%">$ped_total</span>                                </div>                            </div>                            <br>                			<table class="table table-sm">                                <tbody>                                    <tr>                                        <th>Em revisão</td>                                        <td>$ped_revisao_str</td>                                    </tr>                                    <tr>                                        <th>Atendidos</td>                                        <td>$ped_atendidos_str</td>                                    </tr>                                    <tr>                                        <th>Querem HOTEL</td>                                        <td><span class="badge badge-info">$ped_hotel</span></td>                                    </tr>                                </tbody>                            </table>                            <br>                			<table class="table table-sm">                                <tbody>                                    <tr>                                        <th>Pessoas</td>                                        <td><span class="badge badge-primary">$ped_pessoas</span></td>                                    </tr>                                    <tr>                                        <th>Homens</td>                                        <td><span class="badge badge-info">$ped_masc</span></td>                                    </tr>                                    <tr>                                        <th>Mulheres</td>                                        <td><span class="badge badge-info">$ped_fem</span></td>                                    </tr>                                </tbody>                            </table>                        </div>                        <div class="col-6">                            <div class="card bg-dark text-white">                                <div class="card-body text-center">                                    <strong>TOTAL DE FAC</strong><br>                                    <span class="badge badge-light" style="font-size:100%">$fac_total</span>                                </div>                            </div>                            <br>                			<table class="table table-sm">                                <tbody>                                    <tr>                                        <th>Em revisão</td>                                        <td>$fac_revisao_str</td>                                    </tr>                                    <tr>                                        <th>Condição: RAZOÁVEL</td>                                        <td><span class="badge badge-info">$fac_razoavel</span></td>                                    </tr>                                    <tr>                                        <th>Condição: BOA</td>                                        <td><span class="badge badge-info">$fac_boa</span></td>                                    </tr>                                    <tr>                                        <th>Condição: EXCELENTE</td>                                        <td><span class="badge badge-info">$fac_excelente</span></td>                                    </tr>                                </tbody>                            </table>                        </div>                    </div>        		</div>        	</div>		</div>				<div class="col-12 col-md-6 col-lg-4">			<div class="card">        		<div class="card-header">        			<a data-toggle="collapse" data-target="#panel2"><strong>Usuários</strong></a>        		</div>        		<div class="card-body collapse" id="panel2">                    <table class="table table-sm">                        <thead>                            <tr>                                <th>Nível</th>                                <th>Qtd</th>                            </tr>                        </thead>                        <tbody>                            <tr>                                <td>Solicitante</td>                                <td><span class="badge badge-info">$total_sol</span></td>                            </tr>                            <tr>                                <td>Responsável</td>                                <td><span class="badge badge-info">$total_resp</span></td>                            </tr>                            <tr>                                <td>Administrador</td>                                <td><span class="badge badge-info">$total_adm</span></td>                            </tr>                        </tbody>                    </table>        		</div>        	</div>		</div>				<div class="col-12 col-md-6 col-lg-4">			<div class="card">        		<div class="card-header">        			<a data-toggle="collapse" data-target="#panel3"><strong>Cidades</strong></a>        		</div>        		<div class="card-body collapse" id="panel3">                    <table class="table table-sm">                        <tbody>                            <tr>                                <th>Total de cidades</th>                                <td><span class="badge badge-primary">$cid_total</span></td>                            </tr>                            <tr>                                <th>Cidades visitantes</th>                                <td><span class="badge badge-info">$cid_vis</span></td>                            </tr>                            <tr>                                <th>Cidades hospedeiras</th>                                <td><span class="badge badge-info">$cid_hosp</span></td>                            </tr>                        </tbody>                    </table>                    <br>                    <table class="table table-sm">                        <tbody>                            <tr>                                <th>Cidades s/ Solicitante</th>                                <td>$cid_sem_sol_str</td>                            </tr>                            <tr>                                <th>Cidades s/ Responsável</th>                                <td>$cid_sem_resp_str</td>                            </tr>                        </tbody>                    </table>                            		</div>        	</div>		</div>	</div>DADOS;                unset($cid_hosp, $cid_sem_resp, $cid_sem_resp_str, $cid_sem_sol, $cid_sem_sol_str, $cid_total, $cid_vis);        unset($ped_atendidos, $ped_atendidos_str, $ped_fem, $ped_hotel, $ped_masc, $ped_pessoas, $ped_revisao, $ped_revisao_str, $ped_total);        unset($fac_atendidos, $fac_boa, $fac_excelente, $fac_razoavel, $fac_revisao, $fac_revisao_str, $fac_total);                /*         * ###############################         */        $table_peh = '';        $peh_revisar_total = 0;        $peh_pend_total = 0;        $peh_atend_total = 0;        $peh_pessoas_total = 0;        $peh_total_total = 0;                $abc = $this->pdo->query('SELECT cidade.*, CONCAT(login.nome, " ", login.sobrenome) AS nome_completo FROM cidade LEFT JOIN login ON cidade.solicitante_id = login.id WHERE cidade.hospedeiro = 0 ORDER BY cidade.cidade ASC, cidade.estado ASC');        while($reg = $abc->fetch(PDO::FETCH_OBJ)) {                        // Busca informações sobre PEH            $def = $this->pdo->query('SELECT * FROM peh WHERE peh.congregacao_cidade_id = '.$reg->id);            $peh_total = $def->rowCount();            $peh_revisar = 0;            $peh_pend = 0;            $peh_atend = 0;            $peh_pessoas = 0;                                    while($lin = $def->fetch(PDO::FETCH_OBJ)) {                // Conta pessoas                if($lin->oc1_nome != '') {                    $peh_pessoas++;                }                if($lin->oc2_nome != '') {                    $peh_pessoas++;                }                if($lin->oc3_nome != '') {                    $peh_pessoas++;                }                if($lin->oc4_nome != '') {                    $peh_pessoas++;                }                                                                if($lin->revisar == true) { // EM REVISÃO                    $peh_revisar++;                    $peh_pend++;                } else {                    if($lin->fac_id == 0) { // PENDENTE                        $peh_pend++;                    } else { // ATENDIDO                        $peh_atend++;                    }                }            }                        // Trata dados            if($peh_atend == $peh_total) { // 100%                $peh_atend_str = '<span class="badge badge-success" data-toggle="tooltip" title="Todos pedidos atendidos.">'.$peh_atend.'</span>';            } else if($peh_atend >= ($peh_total*0.75)) { // 75%                $peh_atend_str = '<span class="badge badge-warning" data-toggle="tooltip" title="'.round((($peh_atend * 100)/$peh_total), 2).'% dos pedidos foram atendidos.">'.$peh_atend.'</span>';            } else { // Abaixo dos 75%                $peh_atend_str = '<span class="badge badge-danger" data-toggle="tooltip" title="'.round((($peh_atend * 100)/$peh_total), 2).'% dos pedidos foram atendidos.">'.$peh_atend.'</span>';            }                                    if($peh_pend == $peh_total) { // 100% pendente!                $peh_pend_str = '<span class="badge badge-danger" data-toggle="tooltip" title="Todos pedidos encontram-se pendentes.">'.$peh_pend.'</span>';            } else if($peh_pend > 0 && $peh_pend < $peh_total) { // entre 1% e 99% pendente                $peh_pend_str = '<span class="badge badge-warning" data-toggle="tooltip" title="'.round((($peh_pend*100)/$peh_total),2).'% dos pedidos estão pendentes.">'.$peh_pend.'</span>';            } else { // Sem pendências                $peh_pend_str = '<span class="badge badge-success" data-toggle="tooltip" title="Nenhuma pendência.">'.$peh_pend.'</span>';            }                                    if($peh_revisar == 0) { // Nada em revisão                $peh_revisar_str = '<span class="badge badge-success" data-toggle="tooltip" title="Nenhum pedido em revisão.">'.$peh_revisar.'</span>';            } else if($peh_revisar <= ($peh_total * 0.75)) { // Até 75%                $peh_revisar_str = '<span class="badge badge-warning" data-toggle="tooltip" title="'.round((($peh_revisar*100)/$peh_total),2).'% dos pedidos em revisão.">'.$peh_revisar.'</span>';            } else { // Maior que 75%                $peh_revisar_str = '<span class="badge badge-danger" data-toggle="tooltip" title="'.round((($peh_revisar*100)/$peh_total),2).'% dos pedidos em revisão.">'.$peh_revisar.'</span>';            }                                    // ADICIONA NAS VARIÁVEIS DE TOTAL            $peh_revisar_total += $peh_revisar;            $peh_atend_total += $peh_atend;            $peh_pend_total += $peh_pend;            $peh_pessoas_total += $peh_pessoas;            $peh_total_total += $peh_total;                                    $table_peh .=<<<DADOS                            <tr>                                <td>$reg->cidade $reg->estado</td>                                <td>$reg->nome_completo</td>                                <td class="text-center"><span class="badge badge-info">$peh_pessoas</span></td>                                <td class="text-center"><span class="badge badge-primary">$peh_total</span></td>                                <td class="text-center">$peh_atend_str</td>                                <td class="text-center">$peh_pend_str</td>                                <td class="text-center">$peh_revisar_str</td>                            </tr>DADOS;        }                    /*         * ADICIONA LINHA FINAL DE TOTAL         */                // Trata dados        if($peh_atend_total == $peh_total_total) { // 100%            $peh_atend_total_str = '<span class="badge badge-success" data-toggle="tooltip" title="Todos pedidos atendidos.">'.$peh_atend_total.'</span>';        } else if($peh_atend_total >= ($peh_total_total*0.75)) { // 75%            $peh_atend_total_str = '<span class="badge badge-warning" data-toggle="tooltip" title="'.round((($peh_atend_total * 100)/$peh_total_total), 2).'% dos pedidos foram atendidos.">'.$peh_atend_total.'</span>';        } else { // Abaixo dos 75%            $peh_atend_total_str = '<span class="badge badge-danger" data-toggle="tooltip" title="'.round((($peh_atend_total * 100)/$peh_total_total), 2).'% dos pedidos foram atendidos.">'.$peh_atend_total.'</span>';        }                        if($peh_pend_total == $peh_total_total) { // 100% pendente!            $peh_pend_total_str = '<span class="badge badge-danger" data-toggle="tooltip" title="Todos pedidos encontram-se pendentes.">'.$peh_pend_total.'</span>';        } else if($peh_pend_total > 0 && $peh_pend < $peh_total_total) { // entre 1% e 99% pendente            $peh_pend_total_str = '<span class="badge badge-warning" data-toggle="tooltip" title="'.round((($peh_pend_total*100)/$peh_total_total),2).'% dos pedidos estão pendentes.">'.$peh_pend_total.'</span>';        } else { // Sem pendências            $peh_pend_total_str = '<span class="badge badge-success" data-toggle="tooltip" title="Nenhuma pendência.">'.$peh_pend_total.'</span>';        }                        if($peh_revisar_total == 0) { // Nada em revisão            $peh_revisar_total_str = '<span class="badge badge-success" data-toggle="tooltip" title="Nenhum pedido em revisão.">'.$peh_revisar_total.'</span>';        } else if($peh_revisar_total <= ($peh_total_total * 0.75)) { // Até 75%            $peh_revisar_total_str = '<span class="badge badge-warning" data-toggle="tooltip" title="'.round((($peh_revisar_total*100)/$peh_total_total),2).'% dos pedidos em revisão.">'.$peh_revisar_total.'</span>';        } else { // Maior que 75%            $peh_revisar_total_str = '<span class="badge badge-danger" data-toggle="tooltip" title="'.round((($peh_revisar_total*100)/$peh_total_total),2).'% dos pedidos em revisão.">'.$peh_revisar_total.'</span>';        }                $table_peh .=<<<DADOS                                            <tr class="bg-secondary text-white">                                <td colspan="2" class="text-right"><strong>TOTAL</strong></td>                                <td class="text-center"><span class="badge badge-info" data-toggle="tooltip" title="Total de pessoas que precisam de hospedagem.">$peh_pessoas_total</span></td>                                <td class="text-center"><span class="badge badge-primary" data-toggle="tooltip" title="Total de pedidos de hospedagem.">$peh_total_total</span></td>                                <td class="text-center">$peh_atend_total_str</td>                                <td class="text-center">$peh_pend_total_str</td>                                <td class="text-center">$peh_revisar_total_str</td>                            </tr>DADOS;                                $html .=<<<DADOS    <br>    <div class="row">        <div class="col-12">            <div class="card">                <div class="card-header">        			<a data-toggle="collapse" data-target="#panel4"><strong>Pedidos de Hospedagem</strong></a>        		</div>        		<div class="card-body collapse" id="panel4">                    <table class="table table-sm table-bordered table-striped table-hover">                        <thead class="thead-light">                            <tr>                                <th rowspan="2">Cidade</th>                                <th rowspan="2">Solicitante</th>                                <th rowspan="2" class="text-center">Qtd Pessoas</th>                                <th colspan="4" class="text-center">PEDIDOS</th>                            </tr>                            <tr>                                <th class="text-center">Total</th>                                <th class="text-center">Atendidos</th>                                <th class="text-center">Pendentes</th>                                <th class="text-center">Em revisão</th>                            </tr>                        </thead>                        <tbody>                            $table_peh                        </tbody>                    </table>                </div>            </div>        </div>    </div>DADOS;                unset($peh_atend, $peh_atend_str, $peh_atend_total, $peh_atend_total_str, $peh_pend, $peh_pend_str, $peh_pend_total, $peh_pend_total_str);        unset($peh_pessoas, $peh_pessoas_total, $peh_revisar, $peh_revisar_str, $peh_revisar_total_str, $peh_total, $peh_total_total, $table_peh);        unset($abc, $def, $reg, $lin);                        /*         * ###############################         */                $table_fac = '';        $fac_total_total = 0;        $fac_quartos_total = 0;        $fac_atend_total = 0;        $fac_livre_total = 0;        $fac_revisar_total = 0;                $abc = $this->pdo->query('SELECT cidade.*, CONCAT(login.nome, " ", login.sobrenome) AS nome_completo FROM cidade LEFT JOIN login ON cidade.resp_id = login.id WHERE cidade.hospedeiro = 1 ORDER BY cidade.cidade ASC, cidade.estado ASC');        while($reg = $abc->fetch(PDO::FETCH_OBJ)) {                        $def = $this->pdo->query('SELECT fac.*, peh.id AS pehid FROM fac LEFT JOIN peh ON fac.id = peh.fac_id WHERE fac.cidade = '.$reg->id);            $fac_total = $def->rowCount();            $fac_quartos = 0;            $fac_atend = 0;            $fac_livre = 0;            $fac_revisar = 0;                        if($def->rowCount() > 0) {                while($lin = $def->fetch(PDO::FETCH_OBJ)) {                    if($lin->revisar == 0) { // EM REVISÃO                        $fac_revisar++;                        $fac_livre++;                    } else {                        if($lin->pehid > 0) { // Atendido                            $fac_atend++;                        } else { // Livre                            $fac_livre++;                        }                    }                                        $fac_quartos += $lin->quartos_qtd;                }            }                                                $fac_total_total += $fac_total;            $fac_quartos_total += $fac_quartos;            $fac_atend_total += $fac_atend;            $fac_livre_total += $fac_livre;            $fac_revisar_total += $fac_revisar;                                    // Varre PEH em busca de pendências            $def = $this->pdo->query('SELECT peh.* FROM cidade LEFT JOIN peh ON cidade.id = peh.congregacao_cidade_id WHERE cidade.hospedeiro = 0 AND cidade.resp_id = '.$reg->resp_id);            $peh_livre = 0;            $peh_atend = 0;            $peh_total = 0;                                                while($lin = $def->fetch(PDO::FETCH_OBJ)) {                if($lin->fac_id == 0) { // Não atendido                    $peh_livre++;                } else {                    $peh_atend++;                }                                $peh_total++;            }                                                            // Trata dados            if($fac_quartos == 0 && $peh_total == 0){                $fac_quartos_str = '<span class="badge badge-warning" data-toggle="tooltip" title="Essa cidade não tem quartos cadastrados!">'.$fac_quartos.'</span>';            } else if($fac_quartos == 0 && $peh_total > 0){                $fac_quartos_str = '<span class="badge badge-danger" data-toggle="tooltip" title="Essa cidade precisa de quartos! '.$peh_total.' pedido(s) aguardando...">'.$fac_quartos.'</span>';            } else if($fac_quartos < $peh_total) {                $fac_quartos_str = '<span class="badge badge-warning" data-toggle="tooltip" title="A quantidade de pedidos é superior à quantidade de quartos!">'.$fac_quartos.'</span>';            } else {                $fac_quartos_str = '<span class="badge badge-info" data-toggle="tooltip" title="'.$fac_quartos.' quarto(s) encontrado(s) nessa cidade.">'.$fac_quartos.'</span>';            }                        if($fac_total == 0) {                $fac_total_str = '<span class="badge badge-warning" data-toggle="tooltip" title="Essa cidade não tem acomodações cadastradas!">'.$fac_total.'</span>';            } else if($fac_total == 1) {                $fac_total_str = '<span class="badge badge-info" data-toggle="tooltip" title="'.$fac_total.' acomodação cadastrada. Cadastre mais...">'.$fac_total.'</span>';            } else {                $fac_total_str = '<span class="badge badge-info" data-toggle="tooltip" title="'.$fac_total.' acomodações cadastradas.">'.$fac_total.'</span>';            }                        if($fac_atend == $fac_total && $fac_total > 0) {// TODOS FAC EM USO                $fac_atend_str = '<span class="badge badge-success" data-toggle="tooltip" title="Todos as acomodações em uso.">'.$fac_atend.'</span>';            } else if($fac_atend == $fac_total) { // TOTAL DE FAC e DE ATENDIDOS IGUAL                $fac_atend_str = '<span class="badge badge-warning" data-toggle="tooltip" title="Nenhuma acomodação cadastrada para atender pedidos de hospedagem.">'.$fac_atend.'</span>';            } else if($fac_atend >= ($fac_total*0.5)) { // 50% OU MAIS EM USO                $fac_atend_str = '<span class="badge badge-info" data-toggle="tooltip" title="'.round((($fac_atend * 100)/$fac_total), 2).'% das acomodações em uso.">'.$fac_atend.'</span>';            } else { // MENOS DE 50%                $fac_atend_str = '<span class="badge badge-info" data-toggle="tooltip" title="'.round((($fac_atend * 100)/$fac_total), 2).'% das acomodações em uso.">'.$fac_atend.'</span>';            }                                    if($fac_livre == 0 && $peh_livre == 0) { // TUDO ALINHADO                $fac_livre_str = '<span class="badge badge-success" data-toggle="tooltip" title="Nenhuma acomodação livre, nem pedido pendente.">'.$fac_livre.'</span>';            } else if($fac_livre > 0 && $peh_livre == 0) { // MAIS FAC DO QUE PEH                $fac_livre_str = '<span class="badge badge-success" data-toggle="tooltip" title="Ainda há acomodações livres, nenhum pedido pendente.">'.$fac_livre.'</span>';            } else if($fac_livre == 0 && $peh_livre > 0) { // MAIS PEH DO QUE FAC                $fac_livre_str = '<span class="badge badge-danger" data-toggle="tooltip" title="Necessário mais acomodações! Ainda há pedidos pendentes.">'.$fac_livre.'</span>';            } else { // INFORMAR PORCENTAGEM DE FAC LIVRE                $fac_livre_str = '<span class="badge badge-warning" data-toggle="tooltip" title="'.round((($fac_livre*100)/$fac_total), 2).'% das acomodações estão livres.">'.$fac_livre.'</span>';            }                                                if($fac_revisar == 0) { // NADA EM REVISÃO                $fac_revisar_str = '<span class="badge badge-success" data-toggle="tooltip" title="Nenhuma acomodação em revisão.">'.$fac_revisar.'</span>';            } else if($fac_revisar >= ($fac_total * 0.5)) { // MAIS DE 50% EM REVISÃO                $fac_revisar_str = '<span class="badge badge-danger" data-toggle="tooltip" title="'.round((($fac_revisar * 100)/$fac_total), 2).'% das acomodações em revisão! Por favor, dê atenção!">'.$fac_revisar.'</span>';            } else { // MENOS DE 50% EM REVISÃO                $fac_revisar_str = '<span class="badge badge-warning" data-toggle="tooltip" title="'.round((($fac_revisar * 100)/$fac_total), 2).'% das acomodações em revisão!">'.$fac_revisar.'</span>';            }                                                $table_fac .=<<<DADOS                            <tr>                                <td>$reg->cidade $reg->estado</td>                                <td>$reg->nome_completo</td>                                <td class="text-center">$fac_quartos_str</td>                                <td class="text-center">$fac_total_str</td>                                <td class="text-center">$fac_atend_str</td>                                <td class="text-center">$fac_livre_str</td>                                <td class="text-center">$fac_revisar_str</td>                                <td class="text-center bg-secondary"><span class="badge badge-light" title="Total de pedidos que o usuário $reg->nome_completo está designado para cuidar." data-toggle="tooltip">$peh_total</span></td>                                <!-- <td class="text-center bg-secondary"><span class="badge badge-light">$peh_atend</span></td> -->                                <td class="text-center bg-secondary"><span class="badge badge-light">$peh_livre</span></td>                            </tr>DADOS;                                }                    // Adiciona linha de TOTAL        $table_fac .=<<<DADOS                                    <tr class="bg-secondary text-white">                                <td class="text-right" colspan="2"><strong>TOTAL</strong></td>                                <td class="text-center"><span class="badge badge-info">$fac_quartos_total</span></td>                                <td class="text-center"><span class="badge badge-info">$fac_total_total</span></td>                                <td class="text-center"><span class="badge badge-info">$fac_atend_total</span></td>                                <td class="text-center"><span class="badge badge-info">$fac_livre_total</span></td>                                <td class="text-center"><span class="badge badge-info">$fac_revisar_total</span></td>                                <td class="text-center" colspan="2">-</td>                            </tr>DADOS;                        unset($abc, $def, $reg, $lin);                $html.=<<<DADOS	    <br>    <div class="row">        <div class="col-12">            <div class="card">                <div class="card-header">        			<a data-toggle="collapse" data-target="#panel5"><strong>Acomodações</strong></a>        		</div>        		<div class="card-body collapse" id="panel5">                    <table class="table table-sm table-bordered table-striped table-hover">                        <thead class="thead-light">                            <tr>                                <th rowspan="2">Cidade</th>                                <th rowspan="2">Responsável</th>                                <th rowspan="2" class="text-center">Qtd Quartos</th>                                <th colspan="4" class="text-center">Formulários de Acomodação</th>                                <th colspan="2" class="text-center bg-dark text-white">Pedido de Hospedagem                                <a href="javascript:void(0)" data-trigger="focus" data-toggle="popover" data-content="Esses pedidos de hospedagem aqui representados são os PEH designados ao responsável daquela cidade. Caso o responsável esteja cuidando de mais de uma cidade visitante, o total de pedidos associados a ele será mostrado. <br><br> Cabe ao responsável administrar qual cidade visitante ficará em cada cidade hospedeira a qual ele foi designado." title="Que pedidos são esses?"><span class="badge badge-pill badge-light">?</span></a></th>                            </tr>                            <tr>                                <th class="text-center">Total</th>                                <th class="text-center">Atendidos</th>                                <th class="text-center">Livres</th>                                <th class="text-center">Em revisão</th>                                <th class="text-center bg-dark text-white">Total</th>                                <!--<th class="text-center bg-dark text-white">Atendidos</th>-->                                <th class="text-center bg-dark text-white">Pendentes</th>                            </tr>                        </thead>                        <tbody>                            $table_fac                        </tbody>                    </table>                    <small>DICA: Posicione o mouse sobre os números, para ter mais informações.<br>                    DICA: Quando verde, a situação está favorável; amarelo, a situação merece atenção; vermelho, situação crítica! Os tons de azul representam informações relevantes.</small>                </div>            </div>        </div>    </div>	<!-- 	        	<div class="card">        		<div class="card-header">        			<a data-toggle="collapse" data-target=""><strong></strong></a>        		</div>        		<div class="card-body">        		        		</div>        	</div>		 -->DADOS;                                //###################################################################################        // GRÁFICOS                        $html.=<<<DADOS    <br>    <div class="row">        <div class="col-12">            <div class="card">                <div class="card-header">        			<a data-toggle="collapse" data-target="#panel6"><strong>GRÁFICOS</strong></a>        		</div>        		<div class="card-body collapse" id="panel6">                    <!-- Nav tabs -->                    <ul class="nav nav-tabs">                        <li class="nav-item">                            <a class="nav-link active" data-toggle="tab" href="#graf1">PEH por cidade</a>                        </li>                        <li class="nav-item">                            <a class="nav-link" data-toggle="tab" href="#graf2">FAC por cidade</a>                        </li>                        <li class="nav-item">                            <a class="nav-link" data-toggle="tab" href="#graf3">Idade dos Visitantes</a>                        </li>                    </ul>                                        <!-- Tab panes -->                    <div class="tab-content">                        <div class="tab-pane container active" id="graf1"><canvas id="canvas1" class="col-12">Seu navegador não suporta Canvas. Use um navegador com HTML 5 e Javascript ativado.</canvas></div>                        <div class="tab-pane container fade" id="graf2"><canvas id="canvas2" class="col-12">Seu navegador não suporta Canvas. Use um navegador com HTML 5 e Javascript ativado.</canvas></div>                        <div class="tab-pane container fade" id="graf3"><canvas id="canvas3" class="col-12">Seu navegador não suporta Canvas. Use um navegador com HTML 5 e Javascript ativado.</canvas><br>                        <small><strong>OBS.:</strong> Em alguns pedidos de hospedagem (PEH) não foram informados as idades dos visitantes, por esta razão a coluna "Menores de idade" pode apresentar valor alto demais.</small></div>                    </div>                                    </div>            </div>        </div>    </div></div>DADOS;                                return $html;    }        public function Teste()    {                echo $this->FormatTel('7133051226');        echo '<br>';        echo $this->FormatCel('7182197093');            }        }?>